---
import PageLink from "./PageLink.astro";
---

<style>
  @keyframes slideInFromLeft {
    0% {
      transform: translateX(-100%);
      opacity: 0;
    }
    100% {
      transform: translateX(0);
      opacity: 1;
    }
  }

  .slide-in-left {
    animation: slideInFromLeft 0.3s ease forwards;
  }

  @keyframes slideOutToLeft {
    0% {
      transform: translateX(0);
      opacity: 1;
    }
    100% {
      transform: translateX(-100%);
      opacity: 0;
    }
  }

  .slide-out-left {
    animation: slideOutToLeft 0.3s ease forwards;
  }
</style>

<div class="relative">
  <button
    id="menu-toggle"
    class="text-2xl cursor-pointer bg-transparent border-none z-50 relative"
  >
    <span id="menu-icon">☰</span>
  </button>

  <!-- Dropdown Menu -->
  <div
    id="dropdown-menu"
    class="fixed inset-0 top-17.5 hidden flex z-50 flex-col items-start p-8 text-white backdrop-blur-sm
      bg-linear-to-b to-20% from-primary-bg-900 to-primary-bg-900/70"
  >
    <div class="w-full flex flex-col lg:flex-row lg:justify-between gap-8">
      <div class="text-left font-semibold flex flex-col gap-2 w-full lg:w-1/4">
        <a href="/">Home</a>
      </div>

      <!-- Collapsible: Research -->
      <div class="flex flex-col gap-2 w-full lg:w-1/4">
        <button
          class="w-full text-left font-semibold"
          data-target="research-menu">Research</button
        >
        <ul id="research-menu" class="hidden lg:flex mt-2 pl-8 flex-col gap-2">
          <li><PageLink href="/description" text="Description" /></li>
          <li><PageLink href="/wetlab" text="Wetlab" /></li>
          <li><PageLink href="/model" text="Model" /></li>
          <li><PageLink href="/software" text="Software" /></li>
          <li><PageLink href="/hardware" text="Hardware" /></li>
        </ul>
      </div>

      <!-- Collapsible: Support -->
      <div class="flex flex-col gap-2 w-full lg:w-1/4">
        <button
          class="w-full text-left font-semibold"
          data-target="support-menu">Support</button
        >
        <ul id="support-menu" class="hidden lg:flex mt-2 pl-8 flex-col gap-2">
          <li><PageLink href="/finance" text="Finance" /></li>
          <li><PageLink href="/outreach" text="Outreach" /></li>
          <li><PageLink href="/wiki" text="Wiki & Web" /></li>
        </ul>
      </div>

      <!-- Team -->
      <div class="flex flex-col gap-2 w-full lg:w-1/4">
        <button class="w-full text-left font-semibold" data-target="team-menu"
          >Team</button
        >
        <ul id="team-menu" class="hidden lg:flex mt-2 pl-8 flex-col gap-2">
          <li><PageLink href="/team" text="Team" /></li>
          <li><PageLink href="/attributions" text="Attributions" /></li>
          <li><PageLink href="/contribution" text="Contribution" /></li>
        </ul>
      </div>

      <!-- Other -->
      <div class="flex flex-col gap-2 w-full lg:w-1/4">
        <button class="w-full text-left font-semibold" data-target="other-menu"
          >Other</button
        >
        <ul id="other-menu" class="hidden lg:flex mt-2 pl-8 flex-col gap-2">
          <li><PageLink href="/human-practices" text="Human Practices" /></li>
          <li><PageLink href="/entrepreneurship" text="Entrepreneurship" /></li>
          <li><PageLink href="/wiki" text="Wiki" /></li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggle = document.getElementById("menu-toggle");
    const menu = document.getElementById("dropdown-menu");
    const icon = document.getElementById("menu-icon");

    toggle?.addEventListener("click", () => {
      if (!menu || !icon) return;

      const isHidden = menu.classList.contains("hidden");

      if (isHidden) {
        menu.classList.remove("hidden");
        menu.classList.add("slide-in-left");
        icon.textContent = "✕";
      } else {
        menu.classList.remove("slide-in-left");
        menu.classList.add("slide-out-left");
        icon.textContent = "☰";

        // After animation ends, hide the menu
        menu.addEventListener("animationend", function handler() {
          menu.classList.add("hidden");
          menu.classList.remove("slide-out-left");
          menu.removeEventListener("animationend", handler);
        });
      }
    });

    const mediaQuery = window.matchMedia("(max-width: 1024px)");
    document.querySelectorAll("button[data-target]").forEach((button) => {
      const targetId = button.getAttribute("data-target");
      if (!targetId) return;
      const submenu = document.getElementById(targetId);

      button.addEventListener("click", (e) => {
        if (!mediaQuery.matches) return;
        e.preventDefault();
        submenu?.classList.toggle("hidden");
      });
    });
  });
</script>
